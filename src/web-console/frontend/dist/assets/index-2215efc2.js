import{d as j,t as r,w as Y,c as d,x as O,i as n,j as i,e as m,h as e,y as v,f as s,F as R,D as N,T as Q,k as S,v as P,n as T,U as Z,p as ee,q as te,_ as ae,m as le,s as se,o as ne,r as oe,V as ie,Q as ue,W as q,E as H}from"./index-3b510d65.js";import{f as ce,N as re}from"./format-321d7d79.js";const p=D=>(ee("data-v-917f20ad"),D=D(),te(),D),de={key:0,class:"dialog-body user-detail"},pe={class:"section-info"},_e=p(()=>e("p",{class:"title"},"信息面板",-1)),me={class:"user-base-info"},ve=["src"],he={class:"public-info"},fe={class:"user-id"},be=p(()=>e("span",{class:"label"},"用户账号",-1)),ge={class:"nickname"},ye=p(()=>e("span",{class:"label"},"用户昵称",-1)),ke={class:"friend"},we=p(()=>e("span",{class:"label"},"已加好友",-1)),Ce={class:"nickname"},Se=p(()=>e("span",{class:"label"},"权限等级",-1)),De={class:"section-info"},Ie=p(()=>e("p",{class:"title"},"指令使用分布",-1)),Ve={class:"section-info"},Ue=p(()=>e("p",{class:"title"},"禁用指令列表",-1)),Le={class:"limit-list"},Ee=["onClick"],Re={key:1,class:"limit-empty"},Ne={class:"section-info"},Oe=p(()=>e("p",{class:"title"},"订阅列表",-1)),$e={class:"sub-list"},Be={key:1,class:"sub-empty"},Me={class:"section-info"},xe=p(()=>e("p",{class:"title"},"管理面板",-1)),Ke={class:"management-info"},Te={class:"auth-management article-item"},Ae=p(()=>e("p",{class:"label"},"权限设置",-1)),Fe={class:"content"},Qe={class:"int-management article-item"},ze=p(()=>e("p",{class:"label"},"操作冷却",-1)),Je={class:"content"},qe=p(()=>e("span",null,"ms",-1)),He={class:"limit-management article-item"},je=p(()=>e("p",{class:"label"},"指令权限",-1)),Pe={class:"content"},We=j({__name:"user-detail",props:{data:{default:null},authLevelList:{default:()=>[]},cmdKeys:{default:()=>[]}},emits:["reloadData","closeDialog"],setup(D,{expose:z,emit:$}){const k=D,l=r({auth:0,int:0,limits:[]}),I=r(0),_=r(""),w=r(!1);Y(()=>k.data,t=>{t&&Object.keys(t).length!==0&&(_.value="",I.value=0,l.value.auth=t.botAuth,l.value.int=t.interval,l.value.limits=t.limits?JSON.parse(JSON.stringify(t.limits)):[])},{immediate:!0,deep:!0});function V(t){var o;return typeof t=="string"?t:`群 ${t.group_id} - [${(o=ce(t.role))==null?void 0:o.label}]${t.card||t.nickname}`}function U(t){_.value=t,I.value=t?l.value.limits.includes(t)?2:1:0}function B(t){t===1&&l.value.limits.includes(_.value)&&l.value.limits.splice(l.value.limits.findIndex(o=>o===_.value),1),t===2&&!l.value.limits.includes(_.value)&&l.value.limits.push(_.value)}async function f(){if(k.data)try{await T.USER_SET.post({target:k.data.userID,auth:l.value.auth,int:l.value.int,limits:JSON.stringify(l.value.limits)}),Z.success("设置保存成功"),w.value=!1,$("reloadData")}catch{}}function M(){w.value=!0}function g(){$("closeDialog")}return z({openModal:M,closeModal:g}),(t,o)=>{const C=d("el-scrollbar"),L=d("el-radio-button"),x=d("el-radio-group"),E=d("el-input"),K=d("el-option"),A=d("el-select"),F=d("el-button"),c=d("el-dialog");return i(),O(c,{modelValue:w.value,"onUpdate:modelValue":o[4]||(o[4]=h=>w.value=h),class:"user-detail-dialog no-header",onClosed:g,draggable:""},{default:n(()=>{var h;return[t.data?(i(),m("div",de,[e("div",pe,[_e,e("div",me,[e("img",{class:"avatar",src:t.data.avatar,alt:"ERROR",draggable:"false"},null,8,ve),e("div",he,[e("p",fe,[be,e("span",null,v(t.data.userID),1)]),e("p",ge,[ye,e("span",null,v(t.data.nickname),1)]),e("p",ke,[we,e("span",null,v(t.data.isFriend?"是":"否"),1)]),e("p",Ce,[Se,e("span",null,v(t.authLevelList[t.data.botAuth]&&t.authLevelList[t.data.botAuth].label),1)])])])]),e("div",De,[Ie,s(C,{class:"group-info","wrap-class":"scrollbar-wrapper"},{default:n(()=>[(i(!0),m(R,null,N(t.data.groupInfoList,(a,b)=>(i(),m("p",{key:b},v(V(a)),1))),128))]),_:1})]),e("div",Ve,[Ue,s(C,{class:"limit-info","wrap-class":"scrollbar-wrapper"},{default:n(()=>{var a;return[e("ul",Le,[(a=l.value.limits)!=null&&a.length?(i(!0),m(R,{key:0},N(l.value.limits,(b,y)=>(i(),m("li",{key:y,onClick:J=>U(b)},v(b),9,Ee))),128)):(i(),m("li",Re,"该用户可以使用全部指令"))])]}),_:1})]),e("div",Ne,[Oe,s(C,{class:"sub-info","wrap-class":"scrollbar-wrapper"},{default:n(()=>[e("ul",$e,[t.data.subInfo&&t.data.subInfo.length?(i(!0),m(R,{key:0},N(t.data.subInfo,(a,b)=>(i(),m("li",{key:b},v(a),1))),128)):(i(),m("li",Be,"该用户暂未使用订阅服务"))])]),_:1})]),e("div",Me,[xe,e("ul",Ke,[e("li",Te,[Ae,e("div",Fe,[s(x,{modelValue:l.value.auth,"onUpdate:modelValue":o[0]||(o[0]=a=>l.value.auth=a),disabled:((h=t.data)==null?void 0:h.botAuth)===3},{default:n(()=>[(i(!0),m(R,null,N(t.authLevelList,a=>(i(),O(L,{key:a.value,style:Q({"background-color":a.color}),label:a.value,disabled:a.value===3},{default:n(()=>[S(v(a.label),1)]),_:2},1032,["style","label","disabled"]))),128))]),_:1},8,["modelValue","disabled"])])]),e("li",Qe,[ze,e("div",Je,[s(E,{modelValue:l.value.int,"onUpdate:modelValue":o[1]||(o[1]=a=>l.value.int=a),modelModifiers:{number:!0}},{suffix:n(()=>[qe]),_:1},8,["modelValue"])])]),e("li",He,[je,e("div",Pe,[s(A,{modelValue:_.value,"onUpdate:modelValue":o[2]||(o[2]=a=>_.value=a),placeholder:"选择指令Key",disabled:l.value.auth===3,onChange:U},{default:n(()=>[(i(!0),m(R,null,N(t.cmdKeys,(a,b)=>(i(),O(K,{class:"limit-key-dropdown-item",key:b,value:a},null,8,["value"]))),128))]),_:1},8,["modelValue","disabled"]),s(x,{modelValue:I.value,"onUpdate:modelValue":o[3]||(o[3]=a=>I.value=a),disabled:!_.value||l.value.auth===3,onChange:B},{default:n(()=>[s(L,{label:1},{default:n(()=>[S("ON")]),_:1}),s(L,{label:2},{default:n(()=>[S("OFF")]),_:1})]),_:1},8,["modelValue","disabled"])])])]),s(F,{class:"save",onClick:f,round:""},{default:n(()=>[S("保存设置")]),_:1})])])):P("",!0)]}),_:1},8,["modelValue"])}}});const Ge=ae(We,[["__scopeId","data-v-917f20ad"]]),Xe={class:"table-container user"},Ye={class:"nav-btn-box"},Ze={class:"table-view"},et={class:"user-info"},tt=["src"],at={class:"user-nickname"},nt=j({__name:"index",setup(D){const $=r([{id:"userId",name:"QQ",type:"input",placeholder:"qq号"},{id:"sub",name:"订阅",type:"select",itemList:[{label:"已订阅",value:1},{label:"未订阅",value:2}],placeholder:"是否存在订阅"}]),k=[{label:"Banned",color:"#727272",value:0},{label:"User",color:"#55db2c",value:1},{label:"Manager",color:"#31c0c2",value:2},{label:"Master",color:"#ff0000",value:3}],l=le(),I=se(()=>`${l.deviceHeight-(l.device==="mobile",240)-(l.showTab?40:0)}px`);ne(()=>{g()});const _=r([]),w=r([]),V=r(1),U=r(14),B=r(0),f=r(!1),M=oe({userId:"",sub:""});async function g(){f.value=!0;try{const c=await T.USER_LIST.get({page:V.value,length:U.value,...M});_.value=c.data.userInfos,w.value=c.data.cmdKeys,B.value=c.total||0}catch{}f.value=!1}async function t(){V.value=1,await g()}async function o(c){try{await q.confirm("确定移除该用户所有订阅服务？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0})}catch{return}f.value=!0;try{await T.USER_SUB_REMOVE.post({userId:c}),await g(),H({title:"成功",message:"取消该用户订阅服务成功。",type:"success",duration:2e3})}catch{}f.value=!1}const C=r([]);async function L(){try{await q.confirm("删除用户将会清空其订阅并解除好友关系，是否继续？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0})}catch{return}f.value=!0;try{await T.USER_REMOVE_BATCH.post({userIds:C.value.map(c=>c.userID)}),await g(),H({title:"成功",message:"删除用户成功。",type:"success",duration:2e3})}catch{}f.value=!1}function x(c){C.value=c}const E=r(null),K=r(null);function A(c){var h;E.value=JSON.parse(JSON.stringify(c)),(h=K.value)==null||h.openModal()}function F(){E.value=null}return(c,h)=>{const a=d("el-button"),b=d("el-scrollbar"),y=d("el-table-column"),J=d("el-table"),W=d("el-pagination"),G=ie("loading");return i(),m("div",Xe,[e("div",Ye,[s(b,{class:"horizontal-wrap"},{default:n(()=>[s(re,{searchList:$.value,searchData:M,showNum:1,disabled:f.value,onChange:t},{default:n(()=>[s(a,{type:"primary",disabled:C.value.length===0,round:"",onClick:L},{default:n(()=>[S("删除用户")]),_:1},8,["disabled"])]),_:1},8,["searchList","searchData","disabled"])]),_:1})]),e("div",Ze,[ue((i(),O(J,{data:_.value,"header-row-class-name":"table-header",height:I.value,stripe:"",onSelectionChange:x},{default:n(()=>[s(y,{fixed:"left",type:"selection",width:"50",align:"center",prop:"selection",label:"筛选"}),s(y,{prop:"userID",label:"QQ",align:"center","min-width":"110px"}),s(y,{prop:"avatar",label:"用户",align:"center","min-width":"230px"},{default:n(({row:u})=>[e("div",et,[e("img",{class:"user-avatar",src:u.avatar,alt:"ERROR",draggable:"false"},null,8,tt),e("span",at,v(u.nickname),1)])]),_:1}),s(y,{prop:"botAuth",label:"权限",align:"center","min-width":"100px"},{default:n(({row:u})=>[e("div",{class:"lighter-block",style:Q({"background-color":k[u.botAuth].color})},[e("span",null,v(k[u.botAuth].label),1)],4)]),_:1}),s(y,{prop:"subInfo",label:"订阅数",align:"center","min-width":"65px"},{default:n(({row:u})=>[e("span",null,v(u.subInfo.length),1)]),_:1}),s(y,{prop:"isFriend",label:"好友",align:"center","min-width":"60px"},{default:n(({row:u})=>[e("span",{style:Q({color:u.isFriend?"#55db2c":"#ff0000"})},v(u.isFriend?"是":"否"),5)]),_:1}),s(y,{prop:"setting",label:"操作",align:"center","min-width":"110px"},{default:n(({row:u})=>[u.subInfo.length?(i(),O(a,{key:0,type:"primary",onClick:X=>o(u.userID),link:""},{default:n(()=>[S("取消订阅")]),_:2},1032,["onClick"])):P("",!0),s(a,{type:"primary",onClick:X=>A(u),link:""},{default:n(()=>[S("编辑")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","height"])),[[G,f.value]]),s(W,{"current-page":V.value,"onUpdate:currentPage":h[0]||(h[0]=u=>V.value=u),layout:"prev, pager, next","page-size":U.value,"pager-count":7,total:B.value,onCurrentChange:g},null,8,["current-page","page-size","total"])]),s(Ge,{ref_key:"userDetailRef",ref:K,data:E.value,cmdKeys:w.value,"auth-level-list":k,onCloseDialog:F,onReloadData:g},null,8,["data","cmdKeys"])])}}});export{nt as default};
