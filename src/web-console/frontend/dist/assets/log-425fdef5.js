import{d as ne,u as se,t as s,w as re,s as B,r as ue,o as ce,c as w,e as r,f as i,i as R,z as O,h as p,y as m,G as ie,n as pe,j as u,v as F,F as k,D as x,Q as de,R as ge,g as ve,S as W,T as fe,U as N,p as me,q as _e,_ as he}from"./index-689ac86d.js";const ye=D=>(me("data-v-c015865f"),D=D(),_e(),D),we={class:"table-container fix-height logger"},Te={class:"picker"},be={class:"picker-left"},ke={key:0,class:"log-nav-item"},De=ye(()=>p("span",{class:"content"},"自动置底",-1)),Ce={class:"log-nav-item"},Se={class:"log-nav-item"},Ve={class:"log-nav-item"},Re={class:"log-container"},xe={key:0,class:"empty-promote"},Le={key:1,class:"empty-promote"},Me={key:2,class:"log-window"},Ie={class:"content-line"},$e={key:0},Pe=["href"],Fe=ne({__name:"log",setup(D){const K=se(),Y=["TRACE","DEBUG","INFO","WARN","ERROR","FATAL","MARK"],j=[{label:"系统",value:0},{label:"私聊",value:1},{label:"群聊",value:2}],_=s(null);re(()=>K.path,()=>{_.value&&_.value.close()}),s(""),s(!1);const J=s(1);B(()=>`请输入${["滑动验证码ticket","短信验证码"][J.value-1]}并回车发送`);const d=s([]),C=s(!0),S=s(750),V=s(0),U=B(()=>Math.ceil(V.value/S.value));async function Q(t){const e=[];t.reduce((n,c)=>(c.category!=="[progress]"&&(e.push(c),n.category==="[progress]"&&e.push(n)),c)),e.length||e.push(t[t.length-1]),e[0].category==="[progress]"&&d.value[d.value.length-1].category==="[progress]"&&d.value.splice(-1,1),d.value.length+e.length>S.value&&C.value?await $():d.value.push(...e.map(n=>({...n,message:z(n.message)})))}function H(){let t=document.location.protocol==="https:"?"wss:":"ws:";_.value=new WebSocket(`${t}//${document.location.host}/ws/log`),_.value.onmessage=e=>{const a=Z(JSON.parse(e.data));a.length!==0&&(V.value+=a.length,Q(a).then(()=>{ie(()=>{C.value&&$()})}))}}const o=ue({logLevel:"",msgType:null,groupId:""});function Z(t){const e=o.logLevel,a=o.msgType,n=o.groupId;return t.filter(c=>{if(e&&c.level!==e.toUpperCase())return!1;if(typeof a=="number"){const b=/^(?:send to|recv from): \[(Group|Private): .*?(\d+)/.exec(c.message);if(b){const P=b[1];if(a!==(P==="Group"?2:1)||a===2&&n&&n!==b[2])return!1}else if(a!==0)return!1}return!0})}const L=s(!1),v=s(new Date),h=s(1);async function M(t=v.value){L.value=!0;try{const e=await pe.LOG_INFO.get({date:t.getTime(),page:h.value,length:S.value,...o});e.data.length&&(d.value=e.data.map(a=>({...a,message:z(a.message)})),V.value=e.total)}catch{}L.value=!1}function A(){d.value=[],h.value=1}ce(()=>{v.value=ee(),E(v.value)});const I=s(!0);function E(t){A(),o.msgType=null,o.logLevel="",o.groupId="",M(t).then(()=>{var e;I.value=ae(t),I.value?(H(),setTimeout(()=>$(),50)):_&&((e=_.value)==null||e.close())})}async function G(){o.groupId="",await T()}async function T(){A(),await M()}const y=s(null);async function q(t,e){var a;!e&&y.value&&((a=y.value)==null||a.setScrollTop(0)),await M()}async function $(){h.value!==U.value&&(h.value=U.value,await q(null,!0)),setTimeout(()=>{var t,e,a;(t=y.value)!=null&&t.wrapRef&&((a=y.value)==null||a.setScrollTop((e=y.value)==null?void 0:e.wrapRef.scrollHeight))},10)}function X(t){const e=/二维码图片已保存到：.+[\\\/]data[\\\/]qrcode\.png$/;return t.replace(e,`二维码图片链接：${location.origin}/oicq/data/qrcode.png`)}function z(t){typeof t!="string"&&(t=JSON.stringify(t)||""),t=X(t);const e=/(?:(?:ht|f)tps?):\/\/[\w\-]+(?:\.[\w\-]+)+(?:[\w\-.,@?^=%&:/~+*#]*[\w\-@?^=%&/~+#])?/g,a=t.match(e);if(a){const n=t.split(e).map(f=>({type:"text",data:f}));let c=n.length-1;return a.forEach(f=>{n.splice(-c,0,{type:"link",data:f}),c--}),n}return[{type:"text",data:t}]}function ee(){const t=new Date;return new Date(t.getFullYear(),t.getMonth(),t.getDate())}function te(t){return t.getTime()>Date.now()||t.getTime()<new Date("2021-11-2").getTime()}function ae(t){const e=new Date;return e.getDate()===t.getDate()&&e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()}function le(){const t=getSelection();if(!t){N({message:"请先使用鼠标拖选内容",duration:1500});return}const e=t.toString().split(`

`).map(a=>(a=a.replace(/\[(Android|aPad|Watch|iMac|iPad):\d+]/,"[$1:*****]").replace(/ - recv from: \[Private: \d+\((friend|group)\)] (.*)/," [Recv] [Pri-$1] $2").replace(/ - recv from: \[Group: .*] (.*)/," [Recv] [Group] $1").replace(/ - send to: \[(Group|Private): .*]/," [Send] [$1] ---").replace(/(\[[A-Z]+]) - (.*)/,"$1 [Event] $2").replace(/&#93;/g,"]").replace(/&#91;/g,"["),a)).join(`
`);navigator.clipboard.writeText(e).then(()=>{N({message:"内容已复制到剪切板",type:"success",duration:1500})}).catch(a=>{N({message:`复制失败：${a.message}`,type:"error",duration:1500})})}return(t,e)=>{const a=w("el-date-picker"),n=w("el-switch"),c=w("el-option"),f=w("el-select"),b=w("el-input"),P=w("el-pagination");return u(),r("div",we,[i(O(W),{class:"horizontal-wrap"},{default:R(()=>[p("div",Te,[p("div",be,[i(a,{modelValue:v.value,"onUpdate:modelValue":e[0]||(e[0]=l=>v.value=l),type:"date",placeholder:"选择日期",format:"MM-DD",clearable:!1,editable:!1,"disabled-date":te,onChange:E},null,8,["modelValue"]),I.value?(u(),r("div",ke,[De,i(n,{modelValue:C.value,"onUpdate:modelValue":e[1]||(e[1]=l=>C.value=l),"active-color":"#20a53a","inactive-color":"#f1f1f1"},null,8,["modelValue"])])):F("",!0),p("div",Ce,[i(f,{modelValue:o.logLevel,"onUpdate:modelValue":e[2]||(e[2]=l=>o.logLevel=l),placeholder:"日志等级",onChange:T,onClear:T,clearable:""},{default:R(()=>[(u(),r(k,null,x(Y,(l,g)=>i(c,{key:g,label:l,value:l},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),p("div",Se,[i(f,{modelValue:o.msgType,"onUpdate:modelValue":e[3]||(e[3]=l=>o.msgType=l),placeholder:"类型",onChange:G,onClear:G,clearable:""},{default:R(()=>[(u(),r(k,null,x(j,(l,g)=>i(c,{key:g,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),de(p("div",Ve,[i(b,{modelValue:o.groupId,"onUpdate:modelValue":e[4]||(e[4]=l=>o.groupId=l),placeholder:"请输入群号",onKeydown:ve(T,["enter"]),onClear:T,clearable:""},null,8,["modelValue","onKeydown"])],512),[[ge,o.msgType===2]])]),p("div",{class:"picker-right"},[p("div",{class:"copy-button",onClick:le},"去隐私复制")])])]),_:1}),p("div",Re,[L.value?(u(),r("p",xe," 正在获取日志记录，请稍后... ")):d.value.length?(u(),r("div",Me,[i(O(W),{ref_key:"scrollbarRef",ref:y,class:"log-scroll-container"},{default:R(()=>[(u(!0),r(k,null,x(d.value,l=>(u(),r("p",Ie,[p("span",{style:fe({color:l.color})},"["+m(l.time)+"] "+m(l.category)+" ["+m(l.level)+"] - ",5),(u(!0),r(k,null,x(l.message,(g,oe)=>(u(),r(k,{key:oe},[g.type==="text"?(u(),r("span",$e,m(g.data),1)):F("",!0),g.type==="link"?(u(),r("a",{key:1,href:g.data,target:"_blank"},m(g.data),9,Pe)):F("",!0)],64))),128))]))),256))]),_:1},512),i(P,{"current-page":h.value,"onUpdate:currentPage":e[5]||(e[5]=l=>h.value=l),"page-size":S.value,total:V.value,"pager-count":7,layout:"prev, pager, next",onCurrentChange:q},null,8,["current-page","page-size","total"])])):(u(),r("p",Le," 未找到"+m(v.value.getMonth()+1)+"月"+m(v.value.getDate())+"日的日志... ",1))])])}}});const Ue=he(Fe,[["__scopeId","data-v-c015865f"]]);export{Ue as default};
