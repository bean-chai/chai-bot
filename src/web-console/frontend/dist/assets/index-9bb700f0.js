import{d as H,t as d,w as ne,c as _,x as U,i as a,j as c,e as v,h as e,y as b,T as K,f as l,F as B,D as A,k as x,v as X,n as E,U as W,p as Y,q as Z,_ as ee,o as te,X as Q,E as F,W as J,m as ie,s as ce,r as ue,V as re,Q as de}from"./index-689ac86d.js";import{f as le,N as pe}from"./format-d9dc1b5e.js";const k=y=>(Y("data-v-b974e485"),y=y(),Z(),y),_e={key:0,class:"dialog-body user-detail"},me={class:"section-info"},ge=k(()=>e("p",{class:"title"},"信息面板",-1)),ve={class:"user-base-info"},he=["src"],fe={class:"public-info"},be={class:"user-id"},ye=k(()=>e("span",{class:"label"},"群号",-1)),we={class:"nickname"},ke=k(()=>e("span",{class:"label"},"群名",-1)),Ce={class:"auth"},Ie=k(()=>e("span",{class:"label"},"权限等级",-1)),Se={class:"role"},Ve=k(()=>e("span",{class:"label"},"群身份",-1)),$e={class:"section-info"},De=k(()=>e("p",{class:"title"},"禁用指令列表",-1)),Te={class:"limit-list"},xe=["onClick"],Le={key:1,class:"limit-empty"},Re={class:"section-info"},Ne=k(()=>e("p",{class:"title"},"订阅列表",-1)),Be={class:"sub-list"},Me={key:1,class:"sub-empty"},Oe={class:"section-info"},Ae=k(()=>e("p",{class:"title"},"管理面板",-1)),Ue={class:"management-info"},Ee={class:"auth-management article-item"},Ge=k(()=>e("p",{class:"label"},"权限设置",-1)),Ke={class:"content"},Pe={class:"int-management article-item"},ze=k(()=>e("p",{class:"label"},"操作冷却",-1)),Fe={class:"content"},Je=k(()=>e("span",null,"ms",-1)),He={class:"limit-management article-item"},je=k(()=>e("p",{class:"label"},"指令权限",-1)),qe={class:"content"},Qe=H({__name:"group-detail",props:{data:{default:null},authLevelList:{default:()=>[]},cmdKeys:{default:()=>[]}},emits:["reloadData","closeDialog"],setup(y,{expose:M,emit:S}){const V=y,s=d({auth:0,int:0,limits:[]}),h=d(0),i=d(""),f=d({label:"未知",color:"#999"});ne(()=>V.data,t=>{t&&Object.keys(t).length!==0&&(i.value="",h.value=0,f.value=le(t.groupRole)||{label:"未知",color:"#999"},s.value.auth=t.groupAuth,s.value.int=t.interval,s.value.limits=t.limits?JSON.parse(JSON.stringify(t.limits)):[])},{immediate:!0,deep:!0});function I(t){i.value=t,h.value=t?s.value.limits.includes(t)?2:1:0}function R(t){t===1&&s.value.limits.includes(i.value)&&s.value.limits.splice(s.value.limits.findIndex(m=>m===i.value),1),t===2&&!s.value.limits.includes(i.value)&&s.value.limits.push(i.value)}const $=d(!1);async function o(){if(V.data)try{await E.GROUP_SET.post({target:V.data.groupId,auth:s.value.auth,int:s.value.int,limits:JSON.stringify(s.value.limits)}),W.success("设置保存成功"),$.value=!1,S("reloadData")}catch{}}function u(){$.value=!0}function r(){S("closeDialog")}return M({openModal:u,closeModal:r}),(t,m)=>{const D=_("el-scrollbar"),w=_("el-radio-button"),N=_("el-radio-group"),O=_("el-input"),G=_("el-option"),P=_("el-select"),z=_("el-button"),p=_("el-dialog");return c(),U(p,{modelValue:$.value,"onUpdate:modelValue":m[4]||(m[4]=C=>$.value=C),class:"group-detail-dialog no-header",onClosed:r,draggable:""},{default:a(()=>{var C;return[t.data?(c(),v("div",_e,[e("div",me,[ge,e("div",ve,[e("img",{class:"avatar",src:t.data.groupAvatar,alt:"ERROR",draggable:"false"},null,8,he),e("div",fe,[e("p",be,[ye,e("span",null,b(t.data.groupId),1)]),e("p",we,[ke,e("span",null,b(t.data.groupName),1)]),e("p",Ce,[Ie,e("span",null,b((C=t.authLevelList[t.data.groupAuth-1])==null?void 0:C.label),1)]),e("p",Se,[Ve,e("span",{style:K({color:f.value.color})},b(f.value.label),5)])])])]),e("div",$e,[De,l(D,{class:"limit-info","wrap-class":"scrollbar-wrapper"},{default:a(()=>{var n;return[e("ul",Te,[(n=s.value.limits)!=null&&n.length?(c(!0),v(B,{key:0},A(s.value.limits,(L,T)=>(c(),v("li",{key:T,onClick:q=>I(L)},b(L),9,xe))),128)):(c(),v("li",Le,"该群组可以使用全部指令"))])]}),_:1})]),e("div",Re,[Ne,l(D,{class:"sub-info","wrap-class":"scrollbar-wrapper"},{default:a(()=>[e("ul",Be,[t.data.subInfo&&t.data.subInfo.length?(c(!0),v(B,{key:0},A(t.data.subInfo,(n,L)=>(c(),v("li",{key:L},b(n),1))),128)):(c(),v("li",Me,"该用户暂未使用订阅服务"))])]),_:1})]),e("div",Oe,[Ae,e("ul",Ue,[e("li",Ee,[Ge,e("div",Ke,[l(N,{modelValue:s.value.auth,"onUpdate:modelValue":m[0]||(m[0]=n=>s.value.auth=n)},{default:a(()=>[(c(!0),v(B,null,A(t.authLevelList,n=>(c(),U(w,{key:n.value,style:K({"background-color":n.color}),label:n.value},{default:a(()=>[x(b(n.label),1)]),_:2},1032,["style","label"]))),128))]),_:1},8,["modelValue"])])]),e("li",Pe,[ze,e("div",Fe,[l(O,{modelValue:s.value.int,"onUpdate:modelValue":m[1]||(m[1]=n=>s.value.int=n),modelModifiers:{number:!0}},{suffix:a(()=>[Je]),_:1},8,["modelValue"])])]),e("li",He,[je,e("div",qe,[l(P,{modelValue:i.value,"onUpdate:modelValue":m[2]||(m[2]=n=>i.value=n),placeholder:"选择指令Key",onChange:I},{default:a(()=>[(c(!0),v(B,null,A(t.cmdKeys,(n,L)=>(c(),U(G,{class:"limit-key-dropdown-item",key:L,value:n},null,8,["value"]))),128))]),_:1},8,["modelValue"]),l(N,{modelValue:h.value,"onUpdate:modelValue":m[3]||(m[3]=n=>h.value=n),disabled:!i.value,onChange:R},{default:a(()=>[l(w,{label:1},{default:a(()=>[x("ON")]),_:1}),l(w,{label:2},{default:a(()=>[x("OFF")]),_:1})]),_:1},8,["modelValue","disabled"])])])]),l(z,{class:"save",onClick:o,round:""},{default:a(()=>[x("保存设置")]),_:1})])])):X("",!0)]}),_:1},8,["modelValue"])}}});const Xe=ee(Qe,[["__scopeId","data-v-b974e485"]]),j=y=>(Y("data-v-d79c14a0"),y=y(),Z(),y),We={class:"dialog-body send-msg"},Ye={class:"section-info"},Ze=j(()=>e("p",{class:"title"},"发送范围",-1)),et={key:0,class:"group-list"},tt=["src"],lt={key:1},at={class:"section-info"},st=j(()=>e("p",{class:"title"},"群发消息",-1)),ot=j(()=>e("p",{class:"desc"},[e("span",null,"为防止同时群发消息导致风控，消息发送后，将依照以下机制在一定时间后随机推送至各个群聊："),e("br"),e("span",null,"- 每次间隔随机1-4s后发送;"),e("br"),e("span",null,"- 发送8-12次后，下一次随机6-20s后发送。")],-1)),nt=H({__name:"send-msg",props:{selectionList:{default:()=>[]},disabled:{type:Boolean,default:!1}},emits:["closeDialog"],setup(y,{emit:M}){const S=y;function V(){M("closeDialog")}function s(o){o=Math.floor(o/1e3);const u=Math.floor(o/60),r=(o%60).toString().padStart(2,"0");return`${u}分${r}秒`}const h=d("");function i(o){const u=new Date().getTime();if(o<=u)return;h.value=s(o-u);let r=setInterval(()=>{const t=new Date().getTime();o>t?h.value=s(o-t):(h.value="",clearInterval(r),r=null)},1e3)}te(()=>{const o=Q.get()||new Date().getTime();i(o)});const f=d(!1),I=d("");function R(){if(!I.value){W.warning("请输入要发送的内容");return}const o=S.selectionList.map(u=>u.groupId);E.GROUP_SEND_BATCH.post({groupIds:o,content:I.value}).then(u=>{const r=u.data.cdTime;Q.set(u.data.cdTime),i(r),F({title:"成功",message:`发送成功，消息将在${h.value}内推送给所选群聊。`,type:"success"}),f.value=!1}).catch(()=>{})}async function $(){if(S.selectionList.length===0)try{await J.confirm("未选择群聊，将为所有群聊发送消息","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0})}catch{return}f.value=!0}return(o,u)=>{const r=_("el-button"),t=_("el-scrollbar"),m=_("el-input"),D=_("el-dialog");return c(),v(B,null,[l(r,{type:"primary",disabled:o.disabled||h.value.length!==0,round:"",onClick:$},{default:a(()=>[x(b(h.value||"群发消息"),1)]),_:1},8,["disabled"]),l(D,{modelValue:f.value,"onUpdate:modelValue":u[1]||(u[1]=w=>f.value=w),class:"send-msg-dialog no-header",onClosed:V,draggable:""},{default:a(()=>[e("div",We,[e("div",Ye,[Ze,l(t,{class:"group-list-box","wrap-class":"scrollbar-wrapper"},{default:a(()=>[o.selectionList.length!==0?(c(),v("ul",et,[(c(!0),v(B,null,A(o.selectionList,(w,N)=>(c(),v("li",{key:N},[e("img",{src:w.groupAvatar,alt:"AVATAR"},null,8,tt),e("span",null,b(w.groupName),1)]))),128))])):(c(),v("p",lt,"全部群聊"))]),_:1})]),e("div",at,[st,l(m,{modelValue:I.value,"onUpdate:modelValue":u[0]||(u[0]=w=>I.value=w),type:"textarea",maxlength:"120",resize:"none",rows:"4","show-word-limit":""},null,8,["modelValue"]),ot,l(r,{class:"save",onClick:R,round:""},{default:a(()=>[x("发送")]),_:1})])])]),_:1},8,["modelValue"])],64)}}});const it=ee(nt,[["__scopeId","data-v-d79c14a0"]]),ct={class:"table-container user"},ut={class:"nav-btn-box"},rt={class:"table-view"},dt={class:"user-info"},pt=["src"],_t={class:"user-nickname"},vt=H({__name:"index",setup(y){const M=d([{id:"groupId",name:"群号",type:"input"}]),S=[{label:"禁用",color:"#727272",value:1},{label:"正常",color:"#55db2c",value:2}],V=ie(),s=ce(()=>`${V.deviceHeight-(V.device==="mobile",240)-(V.showTab?40:0)}px`);te(()=>{r()});function h(p){return le(p)||{label:"未知",color:"#999"}}const i=d(!1),f=d(1),I=d(14),R=d([]),$=d([]),o=d(0),u=ue({groupId:""});async function r(){i.value=!0;try{const p=await E.GROUP_LIST.get({page:f.value,length:I.value,...u});R.value=p.data.groupInfos,$.value=p.data.cmdKeys,o.value=p.total||0}catch{}i.value=!1}async function t(){f.value=1,await r()}async function m(p){try{await J.confirm("确定移除该用户所有订阅服务？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0})}catch{return}i.value=!0;try{await E.GROUP_SUB_REMOVE.post({groupId:p}),await r(),F({title:"成功",message:"取消该群聊订阅服务成功。",type:"success",duration:2e3})}catch{}i.value=!1}const D=d([]);async function w(){try{await J.confirm("确定退出/解散这些群聊？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0})}catch{return}i.value=!0;try{await E.GROUP_EXIT_BATCH.post({groupIds:D.value.map(p=>p.groupId)}),await r(),F({title:"成功",message:"退出群聊成功。",type:"success",duration:2e3})}catch{}i.value=!1}function N(p){D.value=p}const O=d(null),G=d(null);function P(p){var C;O.value=JSON.parse(JSON.stringify(p)),(C=G.value)==null||C.openModal()}function z(){O.value=null}return(p,C)=>{const n=_("el-button"),L=_("el-scrollbar"),T=_("el-table-column"),q=_("el-table"),ae=_("el-pagination"),se=re("loading");return c(),v("div",ct,[e("div",ut,[l(L,{class:"horizontal-wrap"},{default:a(()=>[l(pe,{searchList:M.value,searchData:u,showNum:1,disabled:i.value,onChange:t},{default:a(()=>[l(n,{type:"primary",disabled:D.value.length===0,round:"",onClick:w},{default:a(()=>[x("退出群聊")]),_:1},8,["disabled"]),l(it,{disabled:i.value,"selection-list":D.value},null,8,["disabled","selection-list"])]),_:1},8,["searchList","searchData","disabled"])]),_:1})]),e("div",rt,[de((c(),U(q,{data:R.value,"header-row-class-name":"table-header",height:s.value,stripe:"",onSelectionChange:N},{default:a(()=>[l(T,{fixed:"left",type:"selection",width:"50",align:"center",prop:"selection",label:"筛选"}),l(T,{prop:"groupId",label:"群号",align:"center","min-width":"110px"}),l(T,{prop:"avatar",label:"用户",align:"center","min-width":"230px"},{default:a(({row:g})=>[e("div",dt,[e("img",{class:"user-avatar",src:g.groupAvatar,alt:"ERROR",draggable:"false"},null,8,pt),e("span",_t,b(g.groupName),1)])]),_:1}),l(T,{prop:"groupAuth",label:"权限",align:"center","min-width":"100px"},{default:a(({row:g})=>[e("div",{class:"lighter-block",style:K({"background-color":S[g.groupAuth-1].color})},[e("span",null,b(S[g.groupAuth-1].label),1)],4)]),_:1}),l(T,{prop:"subInfo",label:"订阅数",align:"center","min-width":"65px"},{default:a(({row:g})=>[e("span",null,b(g.subInfo.length),1)]),_:1}),l(T,{prop:"groupAuth",label:"群身份",align:"center","min-width":"100px"},{default:a(({row:g})=>[e("div",{class:"lighter-block",style:K({"background-color":h(g.groupRole).color})},[e("span",null,b(h(g.groupRole).label),1)],4)]),_:1}),l(T,{prop:"setting",label:"操作",align:"center","min-width":"110px"},{default:a(({row:g})=>[g.subInfo.length?(c(),U(n,{key:0,type:"primary",onClick:oe=>m(g.groupId),link:""},{default:a(()=>[x("取消订阅")]),_:2},1032,["onClick"])):X("",!0),l(n,{type:"primary",onClick:oe=>P(g),link:""},{default:a(()=>[x("编辑")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","height"])),[[se,i.value]]),l(ae,{"current-page":f.value,"onUpdate:currentPage":C[0]||(C[0]=g=>f.value=g),layout:"prev, pager, next","page-size":I.value,"pager-count":7,total:o.value,onCurrentChange:r},null,8,["current-page","page-size","total"])]),l(Xe,{ref_key:"groupDetailRef",ref:G,data:O.value,cmdKeys:$.value,"auth-level-list":S,onCloseDialog:z,onReloadData:r},null,8,["data","cmdKeys"])])}}});export{vt as default};
